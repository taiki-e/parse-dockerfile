{
  "parser_directives": {
    "syntax": {
      "start": 2,
      "value": {
        "span": {
          "start": 9,
          "end": 28
        },
        "value": "docker/dockerfile:1"
      }
    },
    "escape": null,
    "check": null
  },
  "instructions": [
    {
      "kind": "ARG",
      "arg": {
        "span": {
          "start": 30,
          "end": 33
        }
      },
      "arguments": {
        "span": {
          "start": 34,
          "end": 51
        },
        "value": "GO_VERSION=1.25.6"
      }
    },
    {
      "kind": "ARG",
      "arg": {
        "span": {
          "start": 52,
          "end": 55
        }
      },
      "arguments": {
        "span": {
          "start": 56,
          "end": 85
        },
        "value": "BASE_DEBIAN_DISTRO=\"bookworm\""
      }
    },
    {
      "kind": "ARG",
      "arg": {
        "span": {
          "start": 86,
          "end": 89
        }
      },
      "arguments": {
        "span": {
          "start": 90,
          "end": 111
        },
        "value": "PROTOC_VERSION=3.11.4"
      }
    },
    {
      "kind": "FROM",
      "from": {
        "span": {
          "start": 178,
          "end": 182
        }
      },
      "options": [],
      "image": {
        "span": {
          "start": 183,
          "end": 225
        },
        "value": "golang:${GO_VERSION}-${BASE_DEBIAN_DISTRO}"
      },
      "as_": [
        {
          "span": {
            "start": 226,
            "end": 228
          }
        },
        {
          "span": {
            "start": 229,
            "end": 233
          },
          "value": "base"
        }
      ]
    },
    {
      "kind": "RUN",
      "run": {
        "span": {
          "start": 234,
          "end": 237
        }
      },
      "options": [],
      "arguments": {
        "shell": {
          "span": {
            "start": 238,
            "end": 308
          },
          "value": "apt-get update && apt-get --no-install-recommends install -y git unzip"
        }
      },
      "here_docs": []
    },
    {
      "kind": "ARG",
      "arg": {
        "span": {
          "start": 309,
          "end": 312
        }
      },
      "arguments": {
        "span": {
          "start": 313,
          "end": 327
        },
        "value": "PROTOC_VERSION"
      }
    },
    {
      "kind": "ARG",
      "arg": {
        "span": {
          "start": 328,
          "end": 331
        }
      },
      "arguments": {
        "span": {
          "start": 332,
          "end": 340
        },
        "value": "TARGETOS"
      }
    },
    {
      "kind": "ARG",
      "arg": {
        "span": {
          "start": 341,
          "end": 344
        }
      },
      "arguments": {
        "span": {
          "start": 345,
          "end": 355
        },
        "value": "TARGETARCH"
      }
    },
    {
      "kind": "ENV",
      "env": {
        "span": {
          "start": 356,
          "end": 359
        }
      },
      "arguments": {
        "span": {
          "start": 360,
          "end": 377
        },
        "value": "GOTOOLCHAIN=local"
      }
    },
    {
      "kind": "RUN",
      "run": {
        "span": {
          "start": 378,
          "end": 381
        }
      },
      "options": [],
      "arguments": {
        "shell": {
          "span": {
            "start": 387,
            "end": 387
          },
          "value": ""
        }
      },
      "here_docs": [
        {
          "span": {
            "start": 388,
            "end": 681
          },
          "expand": true,
          "value": "  set -e\n  arch=$(echo $TARGETARCH | sed -e s/amd64/x86_64/ -e s/arm64/aarch_64/)\n  wget -q https://github.com/protocolbuffers/protobuf/releases/download/v${PROTOC_VERSION}/protoc-${PROTOC_VERSION}-${TARGETOS}-${arch}.zip\n  unzip protoc-${PROTOC_VERSION}-${TARGETOS}-${arch}.zip -d /usr/local\n"
        }
      ]
    },
    {
      "kind": "WORKDIR",
      "workdir": {
        "span": {
          "start": 685,
          "end": 692
        }
      },
      "arguments": {
        "span": {
          "start": 693,
          "end": 721
        },
        "value": "/go/src/github.com/moby/moby"
      }
    },
    {
      "kind": "FROM",
      "from": {
        "span": {
          "start": 723,
          "end": 727
        }
      },
      "options": [],
      "image": {
        "span": {
          "start": 728,
          "end": 732
        },
        "value": "base"
      },
      "as_": [
        {
          "span": {
            "start": 733,
            "end": 735
          }
        },
        {
          "span": {
            "start": 736,
            "end": 739
          },
          "value": "src"
        }
      ]
    },
    {
      "kind": "WORKDIR",
      "workdir": {
        "span": {
          "start": 740,
          "end": 747
        }
      },
      "arguments": {
        "span": {
          "start": 748,
          "end": 752
        },
        "value": "/out"
      }
    },
    {
      "kind": "COPY",
      "copy": {
        "span": {
          "start": 753,
          "end": 757
        }
      },
      "options": [],
      "src": [
        {
          "path": {
            "span": {
              "start": 758,
              "end": 759
            },
            "value": "."
          }
        }
      ],
      "dest": {
        "span": {
          "start": 760,
          "end": 761
        },
        "value": "."
      }
    },
    {
      "kind": "RUN",
      "run": {
        "span": {
          "start": 762,
          "end": 765
        }
      },
      "options": [],
      "arguments": {
        "shell": {
          "span": {
            "start": 771,
            "end": 771
          },
          "value": ""
        }
      },
      "here_docs": [
        {
          "span": {
            "start": 772,
            "end": 921
          },
          "expand": true,
          "value": "  set -ex\n  git config --global user.email \"moby@example.com\"\n  git config --global user.name \"moby\"\n  git init .\n  git add .\n  git commit -m 'init'\n"
        }
      ]
    },
    {
      "kind": "FROM",
      "from": {
        "span": {
          "start": 926,
          "end": 930
        }
      },
      "options": [],
      "image": {
        "span": {
          "start": 931,
          "end": 935
        },
        "value": "base"
      },
      "as_": [
        {
          "span": {
            "start": 936,
            "end": 938
          }
        },
        {
          "span": {
            "start": 939,
            "end": 944
          },
          "value": "tools"
        }
      ]
    },
    {
      "kind": "RUN",
      "run": {
        "span": {
          "start": 945,
          "end": 948
        }
      },
      "options": [
        {
          "flag_start": 949,
          "name": {
            "span": {
              "start": 951,
              "end": 956
            },
            "value": "mount"
          },
          "value": {
            "span": {
              "start": 957,
              "end": 989
            },
            "value": "from=src,source=/out,target=.,rw"
          }
        },
        {
          "flag_start": 996,
          "name": {
            "span": {
              "start": 998,
              "end": 1003
            },
            "value": "mount"
          },
          "value": {
            "span": {
              "start": 1004,
              "end": 1043
            },
            "value": "type=cache,target=/root/.cache/go-build"
          }
        }
      ],
      "arguments": {
        "shell": {
          "span": {
            "start": 1049,
            "end": 1049
          },
          "value": ""
        }
      },
      "here_docs": [
        {
          "span": {
            "start": 1050,
            "end": 1355
          },
          "expand": true,
          "value": "  set -ex\n  go install -v \\\n    github.com/gogo/protobuf/protoc-gen-gogo \\\n    github.com/gogo/protobuf/protoc-gen-gogofaster \\\n    github.com/gogo/protobuf/protoc-gen-gogoslick \\\n    github.com/golang/protobuf/protoc-gen-go\n  go build -v \\\n    -o /usr/bin/pluginrpc-gen \\\n    ./pkg/plugins/pluginrpc-gen\n"
        }
      ]
    },
    {
      "kind": "FROM",
      "from": {
        "span": {
          "start": 1360,
          "end": 1364
        }
      },
      "options": [],
      "image": {
        "span": {
          "start": 1365,
          "end": 1370
        },
        "value": "tools"
      },
      "as_": [
        {
          "span": {
            "start": 1371,
            "end": 1373
          }
        },
        {
          "span": {
            "start": 1374,
            "end": 1383
          },
          "value": "generated"
        }
      ]
    },
    {
      "kind": "ENV",
      "env": {
        "span": {
          "start": 1384,
          "end": 1387
        }
      },
      "arguments": {
        "span": {
          "start": 1388,
          "end": 1403
        },
        "value": "GO111MODULE=off"
      }
    },
    {
      "kind": "RUN",
      "run": {
        "span": {
          "start": 1404,
          "end": 1407
        }
      },
      "options": [
        {
          "flag_start": 1408,
          "name": {
            "span": {
              "start": 1410,
              "end": 1415
            },
            "value": "mount"
          },
          "value": {
            "span": {
              "start": 1416,
              "end": 1448
            },
            "value": "from=src,source=/out,target=.,rw"
          }
        }
      ],
      "arguments": {
        "shell": {
          "span": {
            "start": 1454,
            "end": 1454
          },
          "value": ""
        }
      },
      "here_docs": [
        {
          "span": {
            "start": 1455,
            "end": 1634
          },
          "expand": true,
          "value": "  set -ex\n  go generate -v ./...\n  mkdir /out\n  git ls-files -m --others -- ':!vendor' 'profiles/seccomp/default.json' '**/*.pb.go' | tar -cf - --files-from - | tar -C /out -xf -\n"
        }
      ]
    },
    {
      "kind": "FROM",
      "from": {
        "span": {
          "start": 1639,
          "end": 1643
        }
      },
      "options": [],
      "image": {
        "span": {
          "start": 1644,
          "end": 1651
        },
        "value": "scratch"
      },
      "as_": [
        {
          "span": {
            "start": 1652,
            "end": 1654
          }
        },
        {
          "span": {
            "start": 1655,
            "end": 1661
          },
          "value": "update"
        }
      ]
    },
    {
      "kind": "COPY",
      "copy": {
        "span": {
          "start": 1662,
          "end": 1666
        }
      },
      "options": [
        {
          "flag_start": 1667,
          "name": {
            "span": {
              "start": 1669,
              "end": 1673
            },
            "value": "from"
          },
          "value": {
            "span": {
              "start": 1674,
              "end": 1683
            },
            "value": "generated"
          }
        }
      ],
      "src": [
        {
          "path": {
            "span": {
              "start": 1684,
              "end": 1688
            },
            "value": "/out"
          }
        }
      ],
      "dest": {
        "span": {
          "start": 1689,
          "end": 1690
        },
        "value": "/"
      }
    },
    {
      "kind": "FROM",
      "from": {
        "span": {
          "start": 1692,
          "end": 1696
        }
      },
      "options": [],
      "image": {
        "span": {
          "start": 1697,
          "end": 1701
        },
        "value": "base"
      },
      "as_": [
        {
          "span": {
            "start": 1702,
            "end": 1704
          }
        },
        {
          "span": {
            "start": 1705,
            "end": 1713
          },
          "value": "validate"
        }
      ]
    },
    {
      "kind": "RUN",
      "run": {
        "span": {
          "start": 1714,
          "end": 1717
        }
      },
      "options": [
        {
          "flag_start": 1718,
          "name": {
            "span": {
              "start": 1720,
              "end": 1725
            },
            "value": "mount"
          },
          "value": {
            "span": {
              "start": 1726,
              "end": 1758
            },
            "value": "from=src,source=/out,target=.,rw"
          }
        },
        {
          "flag_start": 1765,
          "name": {
            "span": {
              "start": 1767,
              "end": 1772
            },
            "value": "mount"
          },
          "value": {
            "span": {
              "start": 1773,
              "end": 1833
            },
            "value": "type=bind,from=generated,source=/out,target=/generated-files"
          }
        }
      ],
      "arguments": {
        "shell": {
          "span": {
            "start": 1839,
            "end": 1839
          },
          "value": ""
        }
      },
      "here_docs": [
        {
          "span": {
            "start": 1840,
            "end": 2193
          },
          "expand": true,
          "value": "  set -e\n  git add -A\n  if [ \"$(ls -A /generated-files)\" ]; then\n    cp -rf /generated-files/* .\n  fi\n  diff=$(git status --porcelain -- ':!vendor' 'profiles/seccomp/default.json' '**/*.pb.go')\n  if [ -n \"$diff\" ]; then\n    echo >&2 'ERROR: The result of \"go generate\" differs. Please update with \"make generate-files\"'\n    echo \"$diff\"\n    exit 1\n  fi\n"
        }
      ]
    }
  ]
}